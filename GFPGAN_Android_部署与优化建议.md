# GFPGAN åœ¨ Android ä¸Šéƒ¨ç½²ä¸è§†é¢‘äººè„¸è¶…åˆ†ä¼˜åŒ–å»ºè®®

ä½œè€…ï¼šè‡ªåŠ¨ç”Ÿæˆï¼ˆåŸºäºå·¥ä½œåŒºä»£ç åˆ†æï¼‰
æ—¥æœŸï¼š2025-12-25

## æ¦‚è¦
æœ¬æ–‡æ¡£æ±‡æ€»äº†é’ˆå¯¹ `GFPGAN_20`ï¼ˆå½“å‰é¡¹ç›®ä¸­åŸºäº `GFPGANv1.4.pth` çš„äººè„¸ä¿®å¤èŠ‚ç‚¹ï¼‰åœ¨äººè„¸è§†é¢‘è¶…åˆ†åœºæ™¯ä¸‹ï¼Œåœ¨ NNDEPLOY æ¡†æ¶å†…é¢å‘ Android ç«¯çš„å¯è¡Œæ€§åˆ†æä¸å¤šå¥—å®ç°æ–¹æ¡ˆï¼Œå¹¶æä¾›å®ç°æ­¥éª¤ã€ä¼˜ç¼ºç‚¹å’Œæ—¶é—´é¢„ä¼°ã€‚

---

## å½“å‰é¡¹ç›®çŠ¶æ€ï¼ˆç»“è®ºå¯¼è¯»ï¼‰
- é¡¹ç›®ä¸­ `GFPGAN` èŠ‚ç‚¹çš„ Python å®ç°ä½äº `python/nndeploy/gan/gfpgan.py`ï¼Œå®ƒä¾èµ– Python çš„ `gfpgan`ï¼ˆåŸºäº PyTorchï¼‰è¿è¡Œã€‚è¯¥å®ç°é»˜è®¤ä½¿ç”¨ `.pth` æ¨¡å‹å’Œ Python æ¨ç†ç¯å¢ƒã€‚
- ç›´æ¥æŠŠ Python+PyTorch çš„å®ç°ç§»æ¤åˆ° Android åŸç”Ÿç¯å¢ƒä¸å¯è¡Œï¼ˆæˆ–ä»£ä»·æé«˜ï¼‰ã€‚æ¨èçš„è½åœ°è·¯å¾„æœ‰ä¸‰ç±»ï¼š
  1. å°† GFPGAN è½¬ä¸ºç§»åŠ¨ç«¯å‹å¥½çš„æ¨ç†æ¨¡å‹ï¼ˆONNX â†’ MNN/NCNN/TNNï¼‰ï¼Œå¹¶å®ç° C++ å‰åå¤„ç†èŠ‚ç‚¹ï¼ˆæ¨èé•¿æœŸæ–¹æ¡ˆï¼‰ï¼›
  2. ä½¿ç”¨è½»é‡çº§ç§»åŠ¨ç«¯è¶…åˆ†æ¨¡å‹æ›¿ä»£ GFPGANï¼ˆå®ç”¨ã€å¿«é€ŸéªŒè¯ï¼‰ï¼›
  3. é‡‡ç”¨æœåŠ¡ç«¯æ¨ç† + Android å®¢æˆ·ç«¯çš„æ··åˆæ¶æ„ï¼ˆæœ€å¿«å¯å¤ç°é«˜è´¨é‡ç»“æœï¼‰ã€‚

---

## æ–¹æ¡ˆè¯¦æƒ…ï¼ˆæŒ‰å®ç”¨æ€§ä¸å®ç°éš¾åº¦åˆ†ç»„ï¼‰

### æ–¹æ¡ˆ Aï¼ˆæ¨èçŸ­æœŸï¼‰ï¼šè½»é‡çº§ç§»åŠ¨è¶…åˆ†æ›¿ä»£ï¼ˆReal-ESRGAN Mobile / EDVR-Lite / SRCNNï¼‰
- å®è´¨ï¼šåœ¨ Android ç«¯ä½¿ç”¨å·²ç»ç»è¿‡ç§»åŠ¨åŒ–çš„å°æ¨¡å‹æ›¿ä»£ GFPGANï¼Œå®Œæˆé¢éƒ¨æ”¾å¤§ä¸ç»†èŠ‚å¢å¼ºã€‚
- å®æ–½è¦ç‚¹ï¼š
  - é€‰æ‹©ä¸€ä¸ªç§»åŠ¨ç«¯å·²é€‚é…çš„æ¨¡å‹ï¼ˆONNX / MNN / NCNNï¼‰ï¼Œä¾‹å¦‚ Real-ESRGAN Mobile æˆ– EDVR-Liteã€‚
  - ä½¿ç”¨ NNDEPLOY ç°æœ‰çš„ `super_resolution` æ’ä»¶ï¼ˆå‚è€ƒ `plugin/include/nndeploy/super_resolution`ï¼‰æŠŠæ¨¡å‹æ¥å…¥å·¥ä½œæµã€‚
  - åœ¨å·¥ä½œæµä¸­æ›¿æ¢ `nndeploy.gan.GFPGAN` èŠ‚ç‚¹ä¸ºç§»åŠ¨è¶…åˆ†èŠ‚ç‚¹ï¼Œæ‰§è¡Œï¼šäººè„¸æ£€æµ‹ â†’ è¶…åˆ† â†’ åˆæˆå›åŸå›¾ã€‚
- ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ã€å®ç°ç®€å•ã€æ— éœ€æœåŠ¡å™¨ã€‚
- ç¼ºç‚¹ï¼šä¿®å¤ç»†èŠ‚ä¸å¦‚åŸç”Ÿ GFPGANã€‚
- é¢„è®¡å·¥ä½œé‡ï¼š1~2 å‘¨ã€‚


### æ–¹æ¡ˆ Bï¼ˆä¸­æœŸï¼Œæ¨èç”¨äºé«˜è´¨é‡ç¦»çº¿/è¿‘çº¿ï¼‰ï¼šGFPGAN è½¬ ONNX å¹¶ä½¿ç”¨ MNN/NCNN/TNNï¼ˆåŸç”Ÿéƒ¨ç½²ï¼‰
- å®è´¨ï¼šæŠŠ GFPGAN çš„ PyTorch `.pth` è½¬ä¸º ONNXï¼Œè§£å†³ç®—å­å…¼å®¹åç”¨ MNN/NCNN/TNN è½¬æ¢å¹¶ç¼–è¯‘åˆ° Androidã€‚
- å…³é”®æ­¥éª¤ï¼š
  1. åœ¨ PC ä¸Šå°† GFPGAN å¯¼å‡ºä¸º ONNXï¼ˆéœ€ä¿®æ­£ PyTorch åŠ¨æ€æ§åˆ¶æµä¸è‡ªå®šä¹‰ç®—å­ï¼‰ã€‚
  2. ç”¨ MNN/NCNN/TNN çš„è½¬æ¢å·¥å…·ç”Ÿæˆç§»åŠ¨ç«¯æ¨¡å‹ï¼ˆå¯èƒ½éœ€è¦æ‰‹åŠ¨æ›¿æ¢/å®ç°ä¸æ”¯æŒç®—å­ï¼‰ã€‚
  3. åœ¨ NNDEPLOY ä¸­å®ç°ä¸€ä¸ª C++ èŠ‚ç‚¹ï¼ˆæˆ–åœ¨ç°æœ‰ `plugin` ä¸­åŠ å…¥ GFPGAN çš„ C++ å‰åå¤„ç†é€»è¾‘ï¼‰ã€‚
  4. ä½¿ç”¨ `cmake` çš„ Android toolchain ç¼–è¯‘åˆ° `lib` å¹¶é›†æˆåˆ° Android Appï¼ˆå‚è§ `app/android/README.md`ï¼‰ã€‚
- ä¼˜ç‚¹ï¼šåŸç”Ÿæ€§èƒ½å¥½ã€å¯è„±ç¦»æœåŠ¡å™¨ï¼›ä¿ç•™ GFPGAN ä¿®å¤è´¨é‡ã€‚
- ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼ˆç®—å­å…¼å®¹ã€å‰åå¤„ç†ã€æ¨¡å‹ä½“ç§¯ã€æ€§èƒ½è°ƒä¼˜ï¼‰ã€‚
- é¢„è®¡å·¥ä½œé‡ï¼š3~8 å‘¨ï¼ˆå–å†³äºç®—å­å…¼å®¹æ€§ä¸ä¼˜åŒ–æ·±åº¦ï¼‰ã€‚

**å¸¸ç”¨è½¬æ¢å‘½ä»¤ï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```bash
# å¯¼å‡º ONNXï¼ˆå¯èƒ½éœ€æ ¹æ® GFPGAN ä»£ç è°ƒæ•´ï¼‰
python export_gfpgan_to_onnx.py --model GFPGANv1.4.pth --output gfpgan.onnx

# ä½¿ç”¨ MNN è½¬æ¢
MNNConvert -f ONNX --modelFile gfpgan.onnx --MNNModel gfpgan.mnn --bizCode MNN
```

æ³¨æ„ï¼šONNX å¯¼å‡ºè¿‡ç¨‹ä¸­å¸¸è§é—®é¢˜åŒ…æ‹¬ï¼šè‡ªå®šä¹‰ç®—å­ã€ä¸æ”¯æŒçš„æ§åˆ¶æµæˆ–åŠ¨æ€å½¢çŠ¶ã€‚å¿…è¦æ—¶éœ€è¦ä¿®æ”¹æ¨¡å‹æˆ–åˆ†è§£ä¸ºå¤šä¸ªå­å›¾ã€‚


### æ–¹æ¡ˆ Cï¼ˆå¿«é€Ÿå¯è¡Œï¼‰ï¼šæœåŠ¡ç«¯æ¨ç† + Android å®¢æˆ·ç«¯ï¼ˆHybridï¼‰
- å®è´¨ï¼šAndroid ç«¯ä¸Šä¼ äººè„¸å¸§æˆ–å…³é”®äººè„¸åŒºåŸŸåˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ï¼ˆGPUï¼‰è¿è¡Œ GFPGAN å®Œæ•´ä¿®å¤å¹¶è¿”å›ç»“æœã€‚
- å®æ–½è¦ç‚¹ï¼š
  - åœ¨æœåŠ¡å™¨ä¸Šè¿è¡ŒåŸç”Ÿ Python GFPGANï¼ˆå¯ä½¿ç”¨ PyTorch + GPUï¼‰ã€‚
  - Android ç«¯åªè´Ÿè´£é‡‡é›†ã€æ˜¾ç¤ºä¸ä¸æœåŠ¡å™¨äº¤äº’ï¼ˆHTTP/REST æˆ– WebSocketï¼‰ã€‚
  - å¯é€‰ï¼šæ‰¹å¤„ç†å¤šå¸§ä»¥æé«˜å¸¦å®½æ•ˆç‡ã€‚
- ä¼˜ç‚¹ï¼šæœ€å¿«æ‹¿åˆ°é«˜è´¨é‡æ•ˆæœã€å¯å³æ—¶åˆ©ç”¨ GPUã€‚
- ç¼ºç‚¹ï¼šéœ€è¦ç½‘ç»œã€å»¶è¿Ÿå’Œæµé‡æˆæœ¬ã€‚
- é¢„è®¡å·¥ä½œé‡ï¼š1~2 å‘¨ï¼ˆå« API ä¸å®¢æˆ·ç«¯é›†æˆï¼‰ã€‚

---

## ä¸ NNDEPLOY é›†æˆå»ºè®®ï¼ˆå·¥ä½œæµä¸é…ç½®ï¼‰
- å·¥ä½œæµç¤ºä¾‹ï¼ˆAndroid-friendlyï¼‰ï¼š
  1. `OpenCvVideoDecode`ï¼ˆè§†é¢‘è§£ç ï¼‰
  2. `InsightFaceAnalysis`ï¼ˆäººè„¸æ£€æµ‹/å…³é”®ç‚¹ï¼‰
  3. `FaceCrop/Align`ï¼ˆè£å‰ªã€å¯¹é½ï¼‰
  4. `MobileSuperResolution`ï¼ˆReal-ESRGAN Mobile æˆ– MNN æ¨¡å‹ï¼‰
  5. `FaceBlend/Composite`ï¼ˆå°†è¶…åˆ†åçš„è„¸åˆæˆå›åŸå›¾ï¼‰
  6. `OpenCvVideoEncode`ï¼ˆè¾“å‡ºè§†é¢‘ï¼‰

- è‹¥é‡‡ç”¨æ–¹æ¡ˆ Bï¼ˆGFPGAN è½¬ MNNï¼‰ï¼šè¯·åœ¨ `node_repository_` å†…å¢åŠ å¦‚ä¸‹èŠ‚ç‚¹é…ç½®ï¼ˆç¤ºä¾‹ï¼‰ï¼š

```json
{
  "key_": "nndeploy.super_resolution.MobileSR",
  "name_": "MobileSR_1",
  "device_type_": "kDeviceTypeCodeArm:0",
  "param_": {
    "model_path_": "resources/models/face/gfpgan_mnn.mnn",
    "inference_backend": "mnn",
    "num_thread_": 4
  }
}
```

---

## æ€§èƒ½ä¸å¯ç”¨æ€§æ³¨æ„äº‹é¡¹
- æ¨¡å‹ä½“ç§¯ï¼šGFPGAN åŸå§‹ `.pth` å¾ˆå¤§ï¼ˆæ•°ç™¾ MBï¼‰ï¼Œè½¬ä¸ºç§»åŠ¨æ¨¡å‹åä»å¯èƒ½è¾ƒå¤§ï¼Œå»ºè®®åšé‡åŒ–ï¼ˆFP16/INT8ï¼‰ã€‚
- è®¾å¤‡é€‰æ‹©ï¼šä¼˜å…ˆä½¿ç”¨å¸¦ NPU/GPU çš„é«˜ç«¯æ‰‹æœºï¼›æˆ–ä½¿ç”¨ MNN çš„ `opencl` / `vulkan` åç«¯ï¼ˆå¦‚æ”¯æŒï¼‰ã€‚
- æ’ä»¶ä¸åç«¯ï¼šNNDEPLOY æ”¯æŒ `MNN`, `TNN`, `NCNN` ç­‰ç§»åŠ¨æ¨ç†åç«¯ï¼Œåœ¨ `cmake/config_android.cmake` ä¸­å¯å¼€å¯å¯¹åº”åç«¯ã€‚

---

## å®æ–½è·¯çº¿ä¸æ—¶é—´é¢„ä¼°ï¼ˆå»ºè®®ï¼‰
- å¿«é€ŸéªŒè¯ï¼ˆ1 å‘¨ï¼‰ï¼šé‡‡ç”¨æ–¹æ¡ˆ Aï¼ˆReal-ESRGAN Mobileï¼‰åœ¨ Android ä¸ŠéªŒè¯ç«¯ä¾§è¶…åˆ†æµç¨‹ã€‚
- ç”Ÿäº§åŒ–ï¼ˆ2-4 å‘¨ï¼‰ï¼šå¦‚æœéœ€è¦æ›´å¥½è´¨é‡ï¼Œä¼˜å…ˆèµ°æ–¹æ¡ˆ Cï¼ˆæœåŠ¡å™¨ï¼‰å¿«é€Ÿä¸Šçº¿ï¼ŒåŒæ—¶å¹¶è¡Œæ¨è¿›æ–¹æ¡ˆ B çš„æ¨¡å‹è½¬æ¢ä¸ç§»æ¤å·¥ä½œã€‚
- æ·±åº¦ä¼˜åŒ–ï¼ˆ1-2 ä¸ªæœˆï¼‰ï¼šå®Œæˆ GFPGAN åˆ° MNN çš„ç§»æ¤ã€é‡åŒ–ä¸ C++ å‰åå¤„ç†å®ç°ï¼Œé›†æˆè¿› NNDEPLOY Android App å¹¶åšæ€§èƒ½è°ƒä¼˜ã€‚

---

## æ¨èä¼˜å…ˆçº§ä¸€è§ˆ
- ä¼˜å…ˆçº§é«˜ï¼šæ–¹æ¡ˆ Aï¼ˆè½»é‡åŒ–æ¨¡å‹ï¼‰ + æ–¹æ¡ˆ Cï¼ˆå¯é€‰ï¼šæœåŠ¡å™¨æ··åˆï¼‰
- ä¸­é•¿æœŸï¼šæ–¹æ¡ˆ Bï¼ˆå®Œæ•´è¿ç§» GFPGAN åˆ°ç§»åŠ¨ç«¯ï¼‰

---

## åç»­å¯é€‰å·¥ä½œï¼ˆæˆ‘å¯ä»¥å¸®æ‚¨å®Œæˆï¼‰
- å¸®æ‚¨ç¼–å†™å¹¶æµ‹è¯• `GFPGAN -> ONNX` çš„å¯¼å‡ºè„šæœ¬ï¼›
- åœ¨ä»“åº“ä¸­æ·»åŠ ç¤ºä¾‹ Android å·¥ä½œæµ JSON ä¸ C++ èŠ‚ç‚¹æ¨¡æ¿ï¼›
- åœ¨ `docs/zh_cn` ä¸­åŠ å…¥ä¸€ä»½â€œAndroid éƒ¨ç½²å®è·µâ€è„šæœ¬ä¸æ­¥éª¤æ¸…å•ã€‚

---

## å‚è€ƒé¡¹ç›®ä¸æ–‡ä»¶ï¼ˆä»“åº“å†…å®šä½ï¼‰
- GFPGAN Python èŠ‚ç‚¹ï¼š `python/nndeploy/gan/gfpgan.py`
- è¶…åˆ†æ’ä»¶ï¼š `plugin/include/nndeploy/super_resolution` å’Œ `plugin/source/nndeploy/super_resolution`
- Android App æ–‡æ¡£ï¼š `app/android/README.md`
- Android CMake é…ç½®ï¼š `cmake/config_android.cmake`

---

## <font style="color:rgb(204, 204, 204);background-color:rgb(24, 24, 24);">ğŸ“Š</font><font style="color:rgb(204, 204, 204);background-color:rgb(24, 24, 24);"> </font>**<font style="color:rgb(204, 204, 204);background-color:rgb(24, 24, 24);">æ€§èƒ½å¯¹æ¯”é¢„ä¼°</font>**
| <font style="color:rgb(204, 204, 204);">æ–¹æ¡ˆ</font> | <font style="color:rgb(204, 204, 204);">å¤„ç†é€Ÿåº¦(720p)</font> | <font style="color:rgb(204, 204, 204);">æ¨¡å‹å¤§å°</font> | <font style="color:rgb(204, 204, 204);">è´¨é‡</font> | <font style="color:rgb(204, 204, 204);">å®æ–½éš¾åº¦</font> |
| :--- | :--- | :--- | :--- | :--- |
| **<font style="color:rgb(204, 204, 204);">åŸç”ŸGFPGAN(PyTorch)</font>** | <font style="color:rgb(204, 204, 204);">âŒ</font><font style="color:rgb(204, 204, 204);"> ä¸æ”¯æŒ</font> | <font style="color:rgb(204, 204, 204);">348MB</font> | <font style="color:rgb(204, 204, 204);">â­â­â­â­â­</font> | <font style="color:rgb(204, 204, 204);">âŒâŒâŒ</font> |
| **<font style="color:rgb(204, 204, 204);">GFPGANè½¬ONNX+MNN</font>** | <font style="color:rgb(204, 204, 204);">0.5-1 FPS</font> | <font style="color:rgb(204, 204, 204);">348MB</font> | <font style="color:rgb(204, 204, 204);">â­â­â­â­â­</font> | <font style="color:rgb(204, 204, 204);">â­â­â­â­</font> |
| **<font style="color:rgb(204, 204, 204);">Real-ESRGAN Mobile</font>** | <font style="color:rgb(204, 204, 204);">3-5 FPS</font> | <font style="color:rgb(204, 204, 204);">5MB</font> | <font style="color:rgb(204, 204, 204);">â­â­â­â­</font> | <font style="color:rgb(204, 204, 204);">â­â­</font> |
| **<font style="color:rgb(204, 204, 204);">EDVR-Lite</font>** | <font style="color:rgb(204, 204, 204);">1-2 FPS</font> | <font style="color:rgb(204, 204, 204);">15MB</font> | <font style="color:rgb(204, 204, 204);">â­â­â­â­â­</font> | <font style="color:rgb(204, 204, 204);">â­â­â­</font> |
| **<font style="color:rgb(204, 204, 204);">æœåŠ¡å™¨æ–¹æ¡ˆ</font>** | <font style="color:rgb(204, 204, 204);">å–å†³äºç½‘é€Ÿ</font> | <font style="color:rgb(204, 204, 204);">0</font> | <font style="color:rgb(204, 204, 204);">â­â­â­â­â­</font> | <font style="color:rgb(204, 204, 204);">â­</font> |

